(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{7980:function(e,t,s){Promise.resolve().then(s.bind(s,575))},575:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var i=s(7437),r=s(2265),n=s(9376),a=s(7120),l=s(1245),d=s(6410),c=s(5978),u=s(2496),o=s(9064);function m(){let{quizId:e}=(0,n.useParams)(),{user:t}=(0,l.a)(),s=(0,n.useRouter)(),[m,x]=(0,r.useState)(null),[h,f]=(0,r.useState)(!0),[g,p]=(0,r.useState)(!1),[y,b]=(0,r.useState)(0),[j,N]=(0,r.useState)({}),[v,w]=(0,r.useState)(!1),[q,z]=(0,r.useState)(null),[k,P]=(0,r.useState)(!1),[S,Z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(t&&e)try{let i=(0,c.IO)((0,c.hJ)(d.db,"attempts"),(0,c.ar)("quizId","==",e),(0,c.ar)("studentId","==",t.uid)),r=await (0,c.PL)(i);if(!r.empty){w(!0);let e=r.docs[0].id;s.push("/student/results/".concat(e));return}let n=await (0,c.QT)((0,c.JU)(d.db,"quizzes",e));if(!n.exists()){o.ZP.error("Quiz not found"),s.push("/student/quizzes");return}let a={id:n.id,...n.data()};if(!a.isPublished){o.ZP.error("This quiz is not available"),s.push("/student/quizzes");return}try{let e=await (0,c.QT)((0,c.JU)(d.db,"users",a.createdBy));e.exists()&&(a.creatorName=e.data().displayName||"Unknown")}catch(e){console.error("Error fetching creator name:",e)}if(x(a),a.timeLimit){let e=60*a.timeLimit;z(e)}}catch(e){console.error("Error fetching quiz:",e),o.ZP.error("Failed to load quiz")}finally{f(!1)}})()},[t,e,s]),(0,r.useEffect)(()=>{if(null===q||q<=0||h||g)return;let e=setInterval(()=>{z(t=>null===t||t<=1?(clearInterval(e),P(!0),0):t-1)},1e3);return()=>clearInterval(e)},[q,h,g]),(0,r.useEffect)(()=>{k&&!g&&!S&&m&&(Z(!0),o.ZP.error("Time is up! Submitting your quiz..."),I(!0))},[k,g,S,m]);let E=(e,t)=>{N({...j,[e]:t})},C=()=>{if(!m)return 0;let e=0;return m.questions.forEach(t=>{let s=j[t.id],i=t.options.find(e=>e.isCorrect);s&&i&&s===i.id&&e++}),Math.round(e/m.questions.length*100)},I=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(m&&t){if(!e){let e=m.questions.filter(e=>!j[e.id]);if(e.length>0){o.ZP.error("Please answer all questions before submitting (".concat(e.length," remaining)"));return}}p(!0);try{let e=C(),i=e>=m.passingPercentage,r={quizId:m.id,quizTitle:m.title,studentId:t.uid,studentName:t.displayName,quizCreatedBy:m.createdBy,score:e,passed:i,answers:j,completedAt:(0,c.Bt)()},n=await (0,c.ET)((0,c.hJ)(d.db,"attempts"),r);o.ZP.success("Quiz submitted successfully!"),s.push("/student/results/".concat(n.id))}catch(e){console.error("Error submitting quiz:",e),o.ZP.error("Failed to submit quiz")}finally{p(!1)}}};if(h)return(0,i.jsx)(a.Z,{children:(0,i.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,i.jsx)(u.Z,{})})});if(v)return(0,i.jsx)(a.Z,{children:(0,i.jsx)("div",{className:"p-6",children:(0,i.jsx)("p",{className:"text-center",children:"Redirecting to your previous attempt..."})})});if(!m)return(0,i.jsx)(a.Z,{children:(0,i.jsx)("div",{className:"p-6",children:(0,i.jsx)("p",{className:"text-center text-red-500",children:"Quiz not found"})})});let Q=m.questions[y],T=y===m.questions.length-1,_=0===y,B=Object.keys(j).length,J=m.questions.length;return(0,i.jsx)(a.Z,{children:(0,i.jsxs)("div",{className:"px-4 py-6",children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:m.title}),null!==q&&(0,i.jsxs)("div",{className:"text-lg font-bold ".concat(q<60?"text-red-600 animate-pulse":"text-gray-700"),children:["Time Remaining: ",Math.floor(q/60),":",(q%60).toString().padStart(2,"0")]})]}),(0,i.jsx)("p",{className:"text-gray-600 mt-2",children:m.description})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsxs)("div",{className:"text-sm font-medium text-gray-500",children:["Question ",y+1," of ",m.questions.length]}),(0,i.jsxs)("div",{className:"text-sm font-medium text-gray-500",children:[B," of ",J," answered"]})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-xl font-medium text-gray-900 mb-4",children:Q.text}),(0,i.jsx)("div",{className:"space-y-3",children:Q.options.map(e=>(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"radio",id:e.id,name:"question-".concat(Q.id),checked:j[Q.id]===e.id,onChange:()=>E(Q.id,e.id),className:"h-4 w-4 text-primary-600 focus:ring-primary-500"}),(0,i.jsx)("label",{htmlFor:e.id,className:"ml-3 block text-gray-700",children:e.text})]},e.id))})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("button",{type:"button",onClick:()=>{y>0&&b(y-1)},disabled:_,className:"px-4 py-2 rounded-md ".concat(_?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-secondary-200 text-secondary-800 hover:bg-secondary-300"),children:"Previous"}),T?(0,i.jsx)("button",{type:"button",onClick:()=>I(),disabled:g||!k&&B!==J,className:"px-4 py-2 rounded-md ".concat(g||B!==J?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:g?"Submitting...":"Submit Quiz"}):(0,i.jsx)("button",{type:"button",onClick:()=>{y<((null==m?void 0:m.questions.length)||0)-1&&b(y+1)},className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700",children:"Next"})]})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Quiz Navigation"}),(0,i.jsx)("div",{className:"grid grid-cols-10 gap-2",children:m.questions.map((e,t)=>(0,i.jsx)("button",{onClick:()=>b(t),className:"h-10 w-10 rounded-md flex items-center justify-center ".concat(y===t?"bg-primary-600 text-white":j[e.id]?"bg-primary-100 text-primary-800":"bg-gray-100 text-gray-800"),children:t+1},e.id))}),(0,i.jsxs)("div",{className:"mt-4 flex justify-between text-sm text-gray-500",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"inline-block h-3 w-3 bg-primary-100 mr-1"}),(0,i.jsx)("span",{children:"Answered"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"inline-block h-3 w-3 bg-primary-600 mr-1"}),(0,i.jsx)("span",{children:"Current"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"inline-block h-3 w-3 bg-gray-100 mr-1"}),(0,i.jsx)("span",{children:"Unanswered"})]})]})]})]})})}}},function(e){e.O(0,[853,139,978,448,64,120,971,117,744],function(){return e(e.s=7980)}),_N_E=e.O()}]);