(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[622],{3945:function(e,t,i){Promise.resolve().then(i.bind(i,6959))},6959:function(e,t,i){"use strict";let s;i.r(t),i.d(t,{default:function(){return b}});var r=i(7437),n=i(2265),a=i(9376),l=i(7120),o=i(1245),c=i(6410),d=i(5978),u=i(9501),m=i(2496),x=i(9064),p=i(7648),h={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let f=new Uint8Array(16),g=[];for(let e=0;e<256;++e)g.push((e+256).toString(16).slice(1));var y=function(e,t,i){if(h.randomUUID&&!t&&!e)return h.randomUUID();let r=(e=e||{}).random??e.rng?.()??function(){if(!s){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");s=crypto.getRandomValues.bind(crypto)}return s(f)}();if(r.length<16)throw Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((i=i||0)<0||i+16>t.length)throw RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[i+e]=r[e];return t}return function(e,t=0){return(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase()}(r)};function b(){let{quizId:e}=(0,a.useParams)(),{user:t}=(0,o.a)(),i=(0,a.useRouter)(),[s,h]=(0,n.useState)(!0),[f,g]=(0,n.useState)(!1),{register:b,control:j,handleSubmit:v,setValue:N,watch:q,formState:{errors:w}}=(0,u.cI)(),{fields:z,append:P,remove:C}=(0,u.Dq)({control:j,name:"questions"}),k=q("questions");(0,n.useEffect)(()=>{(async()=>{if(t&&e)try{var s,r;let n=await (0,d.QT)((0,d.JU)(c.db,"quizzes",e));if(!n.exists()){x.ZP.error("Quiz not found"),i.push("/admin/quizzes");return}let a={id:n.id,...n.data(),createdAt:(null===(s=n.data().createdAt)||void 0===s?void 0:s.toDate())||new Date,updatedAt:(null===(r=n.data().updatedAt)||void 0===r?void 0:r.toDate())||new Date};if(a.createdBy!==t.uid){x.ZP.error("You do not have permission to edit this quiz"),i.push("/admin/quizzes");return}N("title",a.title),N("description",a.description),N("passingPercentage",a.passingPercentage),N("timeLimit",a.timeLimit||30),N("isPublished",a.isPublished),N("questions",a.questions)}catch(e){console.error("Error fetching quiz:",e),x.ZP.error("Failed to load quiz")}finally{h(!1)}})()},[t,e,i,N]);let D=e=>{let t=k[e].options||[];N("questions.".concat(e,".options"),[...t,{id:y(),text:"",isCorrect:!1}])},U=(e,t)=>{let i=[...k[e].options];i.splice(t,1),N("questions.".concat(e,".options"),i)},A=(e,t)=>{let i=[...k[e].options];i.forEach((e,t)=>{i[t]={...e,isCorrect:!1}}),i[t]={...i[t],isCorrect:!0},N("questions.".concat(e,".options"),i)},E=async s=>{if(!t||!e)return;let r=s.questions.filter(e=>!e.options.some(e=>e.isCorrect));if(r.length>0){x.ZP.error("Please select a correct answer for all questions (".concat(r.length," missing)"));return}g(!0);try{let t=(0,d.JU)(c.db,"quizzes",e);await (0,d.r7)(t,{title:s.title,description:s.description,passingPercentage:s.passingPercentage,timeLimit:s.timeLimit,isPublished:s.isPublished,questions:s.questions,updatedAt:new Date}),x.ZP.success("Quiz updated successfully!"),i.push("/admin/quizzes")}catch(e){console.error("Error updating quiz:",e),x.ZP.error("Failed to update quiz")}finally{g(!1)}};return s?(0,r.jsx)(l.Z,{requireAdmin:!0,children:(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)(m.Z,{})})}):(0,r.jsx)(l.Z,{requireAdmin:!0,children:(0,r.jsxs)("div",{className:"px-4 py-6",children:[(0,r.jsxs)("div",{className:"flex items-center mb-6",children:[(0,r.jsx)(p.default,{href:"/admin/quizzes",className:"text-primary-600 hover:text-primary-800 mr-2",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Quiz"})]}),(0,r.jsxs)("form",{onSubmit:v(E),className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Quiz Details"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Quiz Title"}),(0,r.jsx)("input",{id:"title",type:"text",...b("title",{required:"Title is required"}),className:"input-field w-full",placeholder:"Enter quiz title"}),w.title&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.title.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,r.jsx)("textarea",{id:"description",...b("description",{required:"Description is required"}),rows:3,className:"input-field w-full",placeholder:"Enter quiz description"}),w.description&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.description.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"passingPercentage",className:"block text-sm font-medium text-gray-700",children:"Passing Percentage"}),(0,r.jsx)("input",{id:"passingPercentage",type:"number",min:"1",max:"100",...b("passingPercentage",{required:"Passing percentage is required",min:{value:1,message:"Minimum value is 1%"},max:{value:100,message:"Maximum value is 100%"},valueAsNumber:!0}),className:"input-field w-full"}),w.passingPercentage&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.passingPercentage.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"timeLimit",className:"block text-sm font-medium text-gray-700",children:"Time Limit (minutes)"}),(0,r.jsx)("input",{id:"timeLimit",type:"number",min:"1",...b("timeLimit",{required:"Time limit is required",min:{value:1,message:"Minimum time limit is 1 minute"},valueAsNumber:!0}),className:"input-field w-full"}),w.timeLimit&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.timeLimit.message})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"isPublished",type:"checkbox",...b("isPublished"),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"isPublished",className:"ml-2 block text-sm text-gray-900",children:"Publish quiz (make it available to students)"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Questions"}),(0,r.jsx)("button",{type:"button",onClick:()=>{P({id:y(),text:"",type:"multiple-choice",options:[{id:y(),text:"",isCorrect:!1},{id:y(),text:"",isCorrect:!1},{id:y(),text:"",isCorrect:!1},{id:y(),text:"",isCorrect:!1}]})},className:"btn-secondary text-sm",children:"Add Question"})]}),0===z.length?(0,r.jsx)("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:(0,r.jsx)("p",{className:"text-gray-500",children:'No questions added yet. Click "Add Question" to start.'})}):(0,r.jsx)("div",{className:"space-y-6",children:z.map((e,t)=>{var i,s;return(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"font-medium text-gray-900",children:["Question ",t+1]}),(0,r.jsx)("button",{type:"button",onClick:()=>C(t),className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"questions.".concat(t,".text"),className:"block text-sm font-medium text-gray-700",children:"Question Text"}),(0,r.jsx)("input",{id:"questions.".concat(t,".text"),type:"text",...b("questions.".concat(t,".text"),{required:"Question text is required"}),className:"input-field w-full",placeholder:"Enter question text"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"questions.".concat(t,".type"),className:"block text-sm font-medium text-gray-700",children:"Question Type"}),(0,r.jsxs)("select",{id:"questions.".concat(t,".type"),...b("questions.".concat(t,".type")),className:"input-field w-full",children:[(0,r.jsx)("option",{value:"multiple-choice",children:"Multiple Choice"}),(0,r.jsx)("option",{value:"true-false",children:"True/False"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Options (select one correct answer)"}),(0,r.jsx)("button",{type:"button",onClick:()=>D(t),className:"text-primary-600 hover:text-primary-800 text-sm",children:"Add Option"})]}),k&&(null===(s=k[t])||void 0===s?void 0:null===(i=s.options)||void 0===i?void 0:i.map((e,i)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsx)("input",{type:"radio",id:"questions.".concat(t,".options.").concat(i,".isCorrect"),name:"questions[".concat(t,"].correctOption"),checked:e.isCorrect,onChange:()=>A(t,i),className:"h-4 w-4 text-primary-600 focus:ring-primary-500"}),(0,r.jsx)("input",{type:"text",...b("questions.".concat(t,".options.").concat(i,".text"),{required:"Option text is required"}),className:"input-field flex-grow",placeholder:"Option text"}),k[t].options.length>2&&(0,r.jsx)("button",{type:"button",onClick:()=>U(t,i),className:"text-red-600 hover:text-red-800",title:"Delete option","aria-label":"Delete option",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]},e.id)))]})]})]},e.id)})})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)(p.default,{href:"/admin/quizzes",className:"btn-secondary",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:f,className:"btn-primary ".concat(f?"opacity-70 cursor-not-allowed":""),children:f?"Saving...":"Save Quiz"})]})]})]})})}}},function(e){e.O(0,[853,139,978,448,64,501,120,971,117,744],function(){return e(e.s=3945)}),_N_E=e.O()}]);