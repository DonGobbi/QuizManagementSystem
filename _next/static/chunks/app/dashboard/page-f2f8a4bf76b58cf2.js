(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{7249:function(e,t,a){Promise.resolve().then(a.bind(a,441))},441:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(7437),l=a(2265),i=a(1245),d=a(7120),r=a(7648),n=a(6410),c=a(5978),o=a(2496);function m(){let{user:e}=(0,i.a)(),[t,a]=(0,l.useState)([]),[m,u]=(0,l.useState)([]),[x,h]=(0,l.useState)(!0);(0,l.useEffect)(()=>{(async()=>{if(e)try{if("admin"===e.role){let t=(0,c.IO)((0,c.hJ)(n.db,"quizzes"),(0,c.ar)("createdBy","==",e.uid),(0,c.Xo)("createdAt","desc"),(0,c.b9)(5)),s=(await (0,c.PL)(t)).docs.map(e=>{var t,a;return{id:e.id,...e.data(),createdAt:(null===(a=e.data().createdAt)||void 0===a?void 0:null===(t=a.toDate)||void 0===t?void 0:t.call(a))||new Date}});a(s);let l=(0,c.IO)((0,c.hJ)(n.db,"attempts"),(0,c.ar)("quizCreatedBy","==",e.uid),(0,c.Xo)("completedAt","desc"),(0,c.b9)(5)),i=(await (0,c.PL)(l)).docs.map(e=>{var t,a;return{id:e.id,...e.data(),completedAt:(null===(a=e.data().completedAt)||void 0===a?void 0:null===(t=a.toDate)||void 0===t?void 0:t.call(a))||new Date}});u(i)}else try{let t=(0,c.IO)((0,c.hJ)(n.db,"attempts"),(0,c.ar)("studentId","==",e.uid)),s=await (0,c.PL)(t),l=[];s.docs.forEach(e=>{let t=e.data();t.quizId&&l.push(t.quizId)}),console.log("Attempted quiz IDs:",l);let i=(0,c.IO)((0,c.hJ)(n.db,"quizzes"),(0,c.b9)(20)),d=(await (0,c.PL)(i)).docs.map(e=>{var t,a;return{id:e.id,...e.data(),createdAt:(null===(a=e.data().createdAt)||void 0===a?void 0:null===(t=a.toDate)||void 0===t?void 0:t.call(a))||new Date}});console.log("All quizzes before filtering:",d.map(e=>({id:e.id,title:e.title})));let r=d.filter(e=>{let t=l.includes(e.id);return console.log("Quiz ".concat(e.id," (").concat(e.title,") - already taken: ").concat(t)),!t});console.log("Available quizzes after filtering:",r.map(e=>({id:e.id,title:e.title})));let o=r.sort((e,t)=>{let a=new Date(e.createdAt);return new Date(t.createdAt).getTime()-a.getTime()}).slice(0,5);a(o);let m=(0,c.IO)((0,c.hJ)(n.db,"attempts"),(0,c.ar)("studentId","==",e.uid),(0,c.Xo)("completedAt","desc"),(0,c.b9)(5)),x=(await (0,c.PL)(m)).docs.map(e=>{var t,a;return{id:e.id,...e.data(),completedAt:(null===(a=e.data().completedAt)||void 0===a?void 0:null===(t=a.toDate)||void 0===t?void 0:t.call(a))||new Date}});u(x)}catch(e){console.error("Error fetching student data:",e),a([]),u([])}}catch(e){console.error("Error fetching dashboard data:",e)}finally{h(!1)}})()},[e]);let p=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown date";return(0,s.jsx)(d.Z,{children:(0,s.jsxs)("div",{className:"px-4 py-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:(null==e?void 0:e.role)==="admin"?"Admin Dashboard":"Student Dashboard"}),x?(0,s.jsx)(o.Z,{}):(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:(null==e?void 0:e.role)==="admin"?"Your Recent Quizzes":"Available Quizzes"}),(0,s.jsx)(r.default,{href:(null==e?void 0:e.role)==="admin"?"/admin/quizzes":"/student/quizzes",className:"text-primary-600 hover:text-primary-800 text-sm",children:"View all"})]}),(null==e?void 0:e.role)==="student"&&(0,s.jsxs)("section",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Available Quizzes"}),t.length>0?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>(0,s.jsxs)(r.default,{href:"/quizzes/".concat(e.id),className:"block p-4 bg-white rounded-lg shadow hover:shadow-md transition-shadow",children:[(0,s.jsx)("h3",{className:"font-medium text-lg mb-2",children:e.title}),(0,s.jsx)("p",{className:"text-gray-600 text-sm mb-2 line-clamp-2",children:e.description}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[e.questionCount," questions"]}),(0,s.jsx)("p",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:e.timeLimit?"".concat(e.timeLimit," min"):"No time limit"})]}),(0,s.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:(0,s.jsx)("button",{className:"w-full py-1 px-3 bg-primary-600 hover:bg-primary-700 text-white text-sm rounded-md transition-colors",children:"Start Quiz"})})]},e.id))}):(0,s.jsx)("p",{className:"text-gray-500",children:"No quizzes available at the moment."})]}),(null==e?void 0:e.role)==="admin"&&(0,s.jsx)("div",{className:"space-y-4",children:t.length>0?t.map(e=>(0,s.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,s.jsxs)(r.default,{href:"/admin/quizzes/".concat(e.id),className:"block",children:[(0,s.jsx)("h3",{className:"font-medium text-lg text-gray-900",children:e.title}),(0,s.jsx)("p",{className:"text-gray-600 text-sm mb-2 line-clamp-2",children:e.description}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:[e.questionCount," questions"]}),(0,s.jsxs)("span",{children:["Created: ",p(e.createdAt)]})]})]})},e.id)):(0,s.jsx)("p",{className:"text-gray-500",children:(null==e?void 0:e.role)==="admin"?"You haven't created any quizzes yet.":"No quizzes available at the moment."})}),(null==e?void 0:e.role)==="admin"&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(r.default,{href:"/admin/quizzes/create",className:"btn-primary w-full text-center block",children:"Create New Quiz"})})]})}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:(null==e?void 0:e.role)==="admin"?"Recent Student Attempts":"Your Recent Attempts"}),(0,s.jsx)(r.default,{href:(null==e?void 0:e.role)==="admin"?"/admin/results":"/student/results",className:"text-primary-600 hover:text-primary-800 text-sm",children:"View all"})]}),m.length>0?(0,s.jsx)("div",{className:"space-y-4",children:m.map(t=>(0,s.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,s.jsxs)(r.default,{href:(null==e?void 0:e.role)==="admin"?"/admin/results/".concat(t.id):"/student/results/".concat(t.id),className:"block",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:t.quizTitle}),(0,s.jsxs)("div",{className:"flex items-center mt-2",children:[(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(t.passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.passed?"Passed":"Failed"}),(0,s.jsxs)("span",{className:"ml-2 text-sm text-gray-600",children:["Score: ",t.score,"%"]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Completed: ",p(t.completedAt)]})]})},t.id))}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:(null==e?void 0:e.role)==="admin"?"No students have attempted your quizzes yet.":"You haven't attempted any quizzes yet."}),(null==e?void 0:e.role)==="student"&&t.length>0&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(r.default,{href:"/student/quizzes",className:"btn-primary w-full text-center block",children:"Take a Quiz"})})]})})]})]})})}}},function(e){e.O(0,[853,139,978,448,120,971,117,744],function(){return e(e.s=7249)}),_N_E=e.O()}]);